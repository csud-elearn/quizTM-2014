

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>views &mdash; documentation Développement d&#39;une application web de création de quiz 0.1</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="documentation Développement d&#39;une application web de création de quiz 0.1" href="../index.html"/>
        <link rel="up" title="Code du module" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../index.html" class="icon icon-home"> Développement d'une application web de création de quiz
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rapydscript.html">Présentation de RapydScript</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../rapydscript.html#pourquoi-utiliser-python-plutot-que-javascript">Pourquoi utiliser Python plutôt que Javascript ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rapydscript.html#differentes-manieres-d-aborder-le-probleme-coffeescript-brython-et-rapydscript">Différentes manières d&#8217;aborder le problème : CoffeeScript, Brython et RapydScript</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rapydscript.html#introduction-a-rapydscript">Introduction à RapydScript</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../rapydscript.html#installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rapydscript.html#compilation">Compilation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rapydscript.html#programmer-avec-rapydscript">Programmer avec RapydScript</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../rapydscript.html#notions-de-base">Notions de base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rapydscript.html#programmation-orientee-objet-poo">Programmation orientée objet (POO)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rapydscript.html#utilisation-de-la-bibliotheque-standard-python">Utilisation de la bibliothèque standard Python</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rapydscript.html#separer-son-code-en-plusieurs-fichiers">Séparer son code en plusieurs fichiers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rapydscript.html#utilisation-de-fonctions-javascript-natives-ou-provenant-de-librairies-externes">Utilisation de fonctions Javascript natives ou provenant de librairies externes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../doc-user.html">Documentation utilisateur</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../doc-user.html#professeurs">Professeurs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../doc-user.html#creation-de-quiz">Création de quiz</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../doc-user.html#creation-d-une-question-et-definition-de-ses-caracteristiques">Création d&#8217;une question et définition de ses caractéristiques</a></li>
<li class="toctree-l4"><a class="reference internal" href="../doc-user.html#affichage-de-l-apercu-et-des-erreurs">Affichage de l&#8217;aperçu et des erreurs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../doc-user.html#utilisation-de-markdown-pour-la-mise-en-forme">Utilisation de Markdown pour la mise en forme</a></li>
<li class="toctree-l4"><a class="reference internal" href="../doc-user.html#affichage-de-mathematiques">Affichage de mathématiques</a></li>
<li class="toctree-l4"><a class="reference internal" href="../doc-user.html#enregistrement-et-importation-de-brouillons">Enregistrement et importation de brouillons</a></li>
<li class="toctree-l4"><a class="reference internal" href="../doc-user.html#envoi-definitif-du-quiz">Envoi définitif du quiz</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../doc-user.html#suivi-des-eleves">Suivi des élèves</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../doc-user.html#liste-des-quiz-crees-par-un-professeur">Liste des quiz créés par un professeur</a></li>
<li class="toctree-l4"><a class="reference internal" href="../doc-user.html#affichage-des-statistiques-avancees">Affichage des statistiques avancées</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../doc-user.html#etudiants">Étudiants</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../doc-user.html#trouver-un-quiz">Trouver un quiz</a></li>
<li class="toctree-l3"><a class="reference internal" href="../doc-user.html#completer-un-quiz-et-correction-automatique">Compléter un quiz et correction automatique</a></li>
<li class="toctree-l3"><a class="reference internal" href="../doc-user.html#historique-des-resolutions">Historique des résolutions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../global.html">Fonctionnement général de l&#8217;application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../global.html#url">URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../global.html#organisation-des-fichiers-de-l-application">Organisation des fichiers de l&#8217;application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../global.html#bibliotheques-et-frameworks-utilises-dans-l-application">Bibliothèques et frameworks utilisés dans l&#8217;application</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../database.html">Modèle relationnel</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../database.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database.html#utilisation-dans-l-application-de-creation-de-quiz">Utilisation dans l&#8217;application de création de quiz</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../database.html#implementation-dans-django">Implémentation dans Django</a></li>
<li class="toctree-l3"><a class="reference internal" href="../database.html#schema-global">Schéma global</a></li>
<li class="toctree-l3"><a class="reference internal" href="../database.html#explications-des-tables">Explications des tables</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../source.html">Vues Django</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../source.html#concept-de-vue-dans-django">Concept de vue dans Django</a></li>
<li class="toctree-l2"><a class="reference internal" href="../source.html#vues-de-l-application">Vues de l&#8217;application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../source.html#les-formulaires">Les formulaires</a></li>
<li class="toctree-l2"><a class="reference internal" href="../source.html#le-package-utils">Le package <strong>utils</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../source.html#module-quiz.utils.save">utils/save.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="../source.html#module-quiz.utils.submit">utils/submit.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="../source.html#module-quiz.utils.correct">utils/correct.py</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../front-end.html">Outil d&#8217;édition de quiz avec RapydScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conclusion.html">Conclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../end.html">Annexes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../end.html#webographie">Webographie</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Développement d'une application web de création de quiz</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Code du module</a> &raquo;</li>
      
    <li>views</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Code source de views</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf8 -*-</span>

<span class="c"># from django.shortcuts import render, HttpResponse, HttpResponseRedirect, get_object_or_404</span>
<span class="c"># from django.core.urlresolvers import reverse</span>
<span class="c"># # from quiz.utils.save import SaveQuiz</span>
<span class="c"># # from quiz.utils.submit import QuizForms</span>
<span class="c"># # from quiz.utils.correct import CorrectQuiz</span>
<span class="c"># # from quiz.forms import TextForm, CheckboxForm, RadioForm, SelectForm</span>
<span class="c"># # from quiz.models import Quiz, QuizDraft, CompletedQuiz, SqSubmit, QcmSubmitMulti, QcmSubmitOne</span>
<span class="c"># from common.models import Teacher, Student</span>
<span class="c"># from common.auth_utils import *</span>
<span class="c"># from django.contrib.auth.decorators import login_required, user_passes_test</span>
<span class="c"># import json</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;quiz/index.html&#39;</span><span class="p">)</span>

<span class="c">#@login_required</span>
<span class="c">#@user_passes_test(is_teacher)</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">json_string</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;json&#39;</span><span class="p">]</span> <span class="c">#Chaîne json contenant toutes les données des questions du quiz</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span>
        <span class="n">quizcode</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;quizcode&#39;</span><span class="p">]</span> <span class="c">#Code (format texte) du quiz</span>
        
        <span class="n">questions_list</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_string</span><span class="p">)</span> <span class="c">#Parsing du json</span>
        
        <span class="n">teacher_account</span> <span class="o">=</span> <span class="n">Teacher</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span> <span class="c">#Compte prof correspondant à l&#39;user</span>
        
        <span class="n">quiz</span> <span class="o">=</span> <span class="n">SaveQuiz</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">questions_list</span><span class="p">,</span> <span class="n">quizcode</span><span class="p">,</span> <span class="n">teacher_account</span><span class="p">)</span> <span class="c">#Sauvegarde du quiz dans la db</span>
        
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&quot;quiz:complete&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">quiz</span><span class="o">.</span><span class="n">get_id</span><span class="p">()]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;quiz/create.html&#39;</span><span class="p">)</span>

<span class="c">#@login_required</span>
<span class="k">def</span> <span class="nf">complete</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">n_quiz</span><span class="p">):</span>
    <span class="c"># Si la requête est de type POST, on créer un nouveau formulaire et on le remplit avec les données de requête</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">quiz</span> <span class="o">=</span> <span class="n">Quiz</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">n_quiz</span><span class="p">)</span> <span class="c">#Récupération du quiz sélectionné dans la base de donnée</span>
        
        <span class="n">quizforms</span> <span class="o">=</span> <span class="n">QuizForms</span><span class="p">(</span><span class="n">quiz</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        
        <span class="c">#On controle que les formulaires sont valides</span>
        <span class="k">if</span> <span class="n">quizforms</span><span class="o">.</span><span class="n">are_valid</span><span class="p">():</span>
            
            <span class="n">completed</span> <span class="o">=</span> <span class="n">quizforms</span><span class="o">.</span><span class="n">save_answers</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span> <span class="c">#Les réponses sont enregistrées dans la db</span>
            
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&quot;quiz:correct&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">completed</span><span class="o">.</span><span class="n">pk</span><span class="p">]))</span>

    <span class="c"># Si la requête est de type GET, on affiche un formulaire vide</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">quiz</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Quiz</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">n_quiz</span><span class="p">)</span> <span class="c">#Récupération du quiz dans la db</span>
        
        <span class="n">quizforms</span> <span class="o">=</span> <span class="n">QuizForms</span><span class="p">(</span><span class="n">quiz</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span> <span class="s">&#39;quiz/complete.html&#39;</span><span class="p">,</span>
            <span class="p">{</span><span class="s">&#39;quiz&#39;</span><span class="p">:</span> <span class="n">quiz</span><span class="p">,</span> <span class="s">&#39;l_forms&#39;</span><span class="p">:</span> <span class="n">quizforms</span><span class="o">.</span><span class="n">get_forms</span><span class="p">()}</span>
        <span class="p">)</span>
        
<span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span>
        <span class="n">request</span><span class="p">,</span> <span class="s">&#39;quiz/find.html&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&#39;l_quiz&#39;</span> <span class="p">:</span> <span class="n">Quiz</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-creation_date&#39;</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]}</span>
    <span class="p">)</span>

<div class="viewcode-block" id="findquiz"><a class="viewcode-back" href="../source.html#views.findquiz">[docs]</a><span class="k">def</span> <span class="nf">findquiz</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Renvoie sous forme de json le titre et l&#39;url du quiz dont l&#39;url est donné</span>
<span class="sd">    en paramètre de la requête GET.</span>
<span class="sd">    </span>
<span class="sd">    Cette vue est essentiellement destinée à être utilisé par une requête Ajax.</span>
<span class="sd">    </span>
<span class="sd">    Paramètres de la requête GET :</span>
<span class="sd">    quiz --&gt; Id du quiz recherché</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">n_quiz</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;quiz&#39;</span><span class="p">]</span> <span class="c"># id du quiz dans les argument de la requête</span>
        
        <span class="n">quiz</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Quiz</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">n_quiz</span><span class="p">)</span> <span class="c"># Récupération du quiz dans la db</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&quot;quiz:complete&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">n_quiz</span><span class="p">])</span> <span class="c"># Construction de l&#39;url du quiz</span>
        
        <span class="c"># Création d&#39;un dictionnaire contenant les informations à envoyer</span>
        <span class="n">json_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;url&quot;</span> <span class="p">:</span> <span class="n">url</span><span class="p">,</span>
            <span class="s">&quot;title&quot;</span> <span class="p">:</span> <span class="n">quiz</span><span class="o">.</span><span class="n">title</span>
        <span class="p">}</span>
        <span class="n">json_string</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_dict</span><span class="p">)</span> <span class="c"># Sérialisation en json</span>
            
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json_string</span><span class="p">)</span>

<span class="c">#@login_required</span>
<span class="c">#@user_passes_test(is_teacher)</span></div>
<div class="viewcode-block" id="savedraft"><a class="viewcode-back" href="../source.html#views.savedraft">[docs]</a><span class="k">def</span> <span class="nf">savedraft</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Créé une nouvelle entrée dans la table ``QuizDraft``. Le brouillon est associé</span>
<span class="sd">    à l&#39;utilisateur connecté et enregistre les valeurs données en paramètres pour</span>
<span class="sd">    les colonnes title et code.</span>
<span class="sd">    </span>
<span class="sd">    Cette vue n&#39;est disponible que si l&#39;utilisateur connecté appartient au groupe</span>
<span class="sd">    &#39;teachers&#39; et est essentiellement destinée à être utilisé par une requête Ajax.</span>
<span class="sd">    </span>
<span class="sd">    Paramètres de la requête POST :</span>
<span class="sd">    title --&gt; Titre du brouillon</span>
<span class="sd">    code --&gt; Code du quiz</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&quot;title&quot;</span><span class="p">]</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&quot;code&quot;</span><span class="p">]</span>
        
        <span class="c"># Récupération des données du professeur dans la base de données</span>
        <span class="c"># à partir de l&#39;utilisateur connecté</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">Teacher</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        
        <span class="c"># Enregistrement dans la base de données</span>
        <span class="n">draft</span> <span class="o">=</span> <span class="n">QuizDraft</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">,</span> <span class="n">id_teacher</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
        <span class="n">draft</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">draft</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        
<span class="c">#@login_required</span>
<span class="c">#@user_passes_test(is_teacher)</span></div>
<div class="viewcode-block" id="listdrafts"><a class="viewcode-back" href="../source.html#views.listdrafts">[docs]</a><span class="k">def</span> <span class="nf">listdrafts</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Renvoie le titre et l&#39;id de tous les brouillons de l&#39;utilisateur connecté</span>
<span class="sd">    sous forme de json.</span>
<span class="sd">    </span>
<span class="sd">    Cette vue est essentiellement destinée à être utilisé par une requête Ajax.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;GET&quot;</span><span class="p">:</span>
        <span class="c"># Récupération du professeur à partir des données de l&#39;utilisateur connecté</span>
        <span class="n">teacher_account</span> <span class="o">=</span> <span class="n">Teacher</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        
        <span class="c"># Récupération de tous les quiz appartenant au professeur connecté</span>
        <span class="n">drafts</span> <span class="o">=</span> <span class="n">QuizDraft</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id_teacher</span><span class="o">=</span><span class="n">teacher_account</span><span class="p">)</span>
        
        <span class="n">list_drafts</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># Liste qui sera sérializée</span>
        
        <span class="c"># Ajout de dictionnaires contenant les données des brouillons dans la liste</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">drafts</span><span class="p">:</span>
            <span class="n">list_drafts</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s">&quot;title&quot;</span> <span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                <span class="s">&quot;id&quot;</span> <span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="p">})</span>
            
        <span class="n">json_string</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">list_drafts</span><span class="p">)</span> <span class="c"># Sérialisation de la liste</span>
    
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json_string</span><span class="p">)</span>

<span class="c">#@login_required</span>
<span class="c">#@user_passes_test(is_teacher)</span></div>
<div class="viewcode-block" id="getdraft"><a class="viewcode-back" href="../source.html#views.getdraft">[docs]</a><span class="k">def</span> <span class="nf">getdraft</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Renvoie sous forme de json le titre et le code correspondant au brouillon en</span>
<span class="sd">    paramètre.</span>
<span class="sd">    </span>
<span class="sd">    Cette vue est essentiellement destinée à être utilisé par une requête Ajax.</span>
<span class="sd">    </span>
<span class="sd">    Paramètres de la requête GET :</span>
<span class="sd">    draft --&gt; id du brouillon</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">n_draft</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;draft&#39;</span><span class="p">]</span>
        
        <span class="n">draft</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">QuizDraft</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">n_draft</span><span class="p">)</span>
        <span class="n">teacher_account</span> <span class="o">=</span> <span class="n">Teacher</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        
        <span class="c"># On contrôle que le brouillon appartient au professeur connecté</span>
        <span class="k">if</span> <span class="n">draft</span><span class="o">.</span><span class="n">id_teacher</span> <span class="o">==</span> <span class="n">teacher_account</span><span class="p">:</span>
            <span class="c"># Construction d&#39;un dictionnaire contenant les données du brouillon</span>
            <span class="n">json_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&quot;title&quot;</span> <span class="p">:</span> <span class="n">draft</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                <span class="s">&quot;code&quot;</span> <span class="p">:</span> <span class="n">draft</span><span class="o">.</span><span class="n">code</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">json_string</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_dict</span><span class="p">)</span> <span class="c"># Sérialisation du dictionnaire</span>
            
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json_string</span><span class="p">)</span>
<span class="c">#@login_required</span></div>
<div class="viewcode-block" id="correct"><a class="viewcode-back" href="../source.html#views.correct">[docs]</a><span class="k">def</span> <span class="nf">correct</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">n_completed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Corrige les réponses soumises par un étudiant</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">completed</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">CompletedQuiz</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">n_completed</span><span class="p">)</span>
    
    <span class="n">correctquiz</span> <span class="o">=</span> <span class="n">CorrectQuiz</span><span class="p">(</span><span class="n">completed</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;quiz/correct.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;correctquiz&#39;</span> <span class="p">:</span> <span class="n">correctquiz</span><span class="p">,</span> <span class="s">&#39;quiz&#39;</span> <span class="p">:</span> <span class="n">completed</span><span class="o">.</span><span class="n">id_quiz</span><span class="p">})</span>

<span class="c">#@login_required</span></div>
<div class="viewcode-block" id="completed_quizzes"><a class="viewcode-back" href="../source.html#views.completed_quizzes">[docs]</a><span class="k">def</span> <span class="nf">completed_quizzes</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Affiche la liste des résolutions de quiz de l&#39;élève</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Récupération des résolutions de l&#39;élève dans la db</span>
    <span class="n">l_completed</span> <span class="o">=</span> <span class="n">CompletedQuiz</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id_user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;quiz/completed-quizzes.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;l_completed&#39;</span> <span class="p">:</span> <span class="n">l_completed</span><span class="p">})</span>

<span class="c">#@login_required</span>
<span class="c">#@user_passes_test(is_teacher)</span></div>
<div class="viewcode-block" id="created_quizzes"><a class="viewcode-back" href="../source.html#views.created_quizzes">[docs]</a><span class="k">def</span> <span class="nf">created_quizzes</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Affiche la liste des quiz créés par le prof</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Récupération des quiz créés par le prof dans la db</span>
    <span class="n">teacher</span> <span class="o">=</span> <span class="n">Teacher</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
    <span class="n">l_created</span> <span class="o">=</span> <span class="n">Quiz</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id_teacher</span><span class="o">=</span><span class="n">teacher</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;quiz/created-quizzes.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;l_created&#39;</span> <span class="p">:</span> <span class="n">l_created</span><span class="p">})</span>
    
<span class="c">#@login_required</span>
<span class="c">#@user_passes_test(is_teacher)</span></div>
<div class="viewcode-block" id="advanced_stats"><a class="viewcode-back" href="../source.html#views.advanced_stats">[docs]</a><span class="k">def</span> <span class="nf">advanced_stats</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">n_quiz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Affiche les statistiques avancées du quiz en argument</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">quiz</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Quiz</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">n_quiz</span><span class="p">)</span>
    <span class="n">l_completed</span> <span class="o">=</span> <span class="n">CompletedQuiz</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id_quiz</span><span class="o">=</span><span class="n">quiz</span><span class="p">)</span>
    <span class="n">quizforms</span> <span class="o">=</span> <span class="n">QuizForms</span><span class="p">(</span><span class="n">quiz</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;quiz/advanced-stats.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;quiz&#39;</span> <span class="p">:</span> <span class="n">quiz</span><span class="p">,</span> <span class="s">&#39;l_completed&#39;</span> <span class="p">:</span> <span class="n">l_completed</span><span class="p">,</span> <span class="s">&#39;l_forms&#39;</span> <span class="p">:</span> <span class="n">quizforms</span><span class="o">.</span><span class="n">get_forms</span><span class="p">()})</span></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Benoît Léo Maillard.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>